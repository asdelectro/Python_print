<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Принтер этикеток - RCDevices</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="main-container">
        <div class="panel">
            <div class="header">
                <div class="brand-line">
                    <img src="https://www.radiacode.com/favicon.ico" alt="Radiacode" class="brand-icon">
                    <span class="brand-name">Radiacode</span>
                    <span class="divider">|</span>
                    <span class="app-title">Принтер этикеток RCDevices</span>
                </div>
                <div class="config-toggles">
                    <div class="toggle-item">
                        Проверки устройства: <span id="validationStatus" style="font-weight: bold;"></span>
                        <button type="button" class="toggle-btn" onclick="toggleValidation()">Переключить</button>
                    </div>
                    <div class="toggle-item">
                        Физическая печать: <span id="printStatus" style="font-weight: bold;"></span>
                        <button type="button" class="toggle-btn" onclick="togglePrint()">Переключить</button>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-header">
                    <div class="progress-title">Прогресс обработки устройства</div>
                    <div class="progress-subtitle" id="deviceSerial">Ожидание подключения...</div>
                </div>
                
                <div class="main-progress">
                    <div class="progress-fill" id="mainProgress"></div>
                </div>
                
                <div class="progress-text" id="progressText">
                    Готов к работе
                </div>

                <!-- Auto Mode Controls -->
                <div class="auto-controls">
                    <button class="auto-btn" id="autoModeBtn" onclick="toggleAutoMode()">
                        Включить автоматический режим
                    </button>
                    <button class="auto-btn stop" id="stopAutoBtn" onclick="stopAutoMode()" style="display: none;">
                        Остановить автоматический режим
                    </button>
                </div>
            </div>

            <!-- Steps Container -->
            <div class="steps-container">
                <!-- Step 1: Connect Device -->
                <div class="step-item pending" id="step1">
                    <div class="step-icon">1</div>
                    <div class="step-content">
                        <div class="step-title">1. Подключение устройства</div>
                        <div class="step-description">Проверка подключения и получение данных</div>
                        <button class="btn" onclick="connectDevice()" id="connectBtn">
                            Подключиться к устройству
                        </button>
                    </div>
                </div>

                <!-- Step 2: Validate Device -->
                <div class="step-item pending" id="step2">
                    <div class="step-icon">2</div>
                    <div class="step-content">
                        <div class="step-title">2. Проверка в базе данных</div>
                        <div class="step-description">Автоматическая валидация параметров устройства</div>
                        <div class="device-status-box" id="deviceStatusBox" style="display: none;">
                            <div class="device-status-item">
                                <span><strong>Serial:</strong> <span id="serialValue">-</span></span>
                                <span id="serialIcon">⏳</span>
                            </div>
                            <div class="device-status-item">
                                <span><strong>Tests OK:</strong> <span id="testsValue">-</span></span>
                                <span id="testsIcon">⏳</span>
                            </div>
                            <div class="device-status-item">
                                <span><strong>Calibration OK:</strong> <span id="calibValue">-</span></span>
                                <span id="calibIcon">⏳</span>
                            </div>
                            <div class="device-status-item">
                                <span><strong>Status:</strong> <span id="statusValue">-</span></span>
                                <span id="statusIcon">⏳</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Print Label -->
                <div class="step-item pending" id="step3">
                    <div class="step-icon">3</div>
                    <div class="step-content">
                        <div class="step-title">3. Печать этикетки</div>
                        <div class="step-description">Создание и печать этикетки</div>
                        <button class="btn" onclick="printLabel()" disabled id="printBtn">
                            Создать и распечатать этикетку
                        </button>
                    </div>
                </div>

                <!-- Step 4: Scan Label -->
                <div class="step-item pending" id="step4">
                    <div class="step-icon">4</div>
                    <div class="step-content">
                        <div class="step-title">4. Сканирование этикетки</div>
                        <div class="step-description">Ожидание сканирования напечатанной этикетки</div>
                        <div class="scan-section-content" id="scanContent" style="display: none;">
                            <div class="scan-barcode" id="scanBarcode">Ожидание сканирования...</div>
                            <button class="btn btn-secondary" onclick="checkScanStatus()">
                                Проверить статус сканирования
                            </button>
                        </div>
                        <div class="step-note">
                            Наклейте этикетку на устройство и отсканируйте её для завершения процесса
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scanned Items Preview -->
            <div id="scannedItems" class="scanned-items" style="display: none;">
                <div style="color: #ffffff; font-size: 16px; font-weight: 400; margin-bottom: 12px; text-align: center;">
                    Последние отсканированные этикетки
                </div>
                <div id="itemsList"></div>
            </div>

            <div class="status" id="status"></div>

            <!-- Brand Footer -->
            <div class="brand-footer">
                <div class="footer-content">
                    <img src="https://www.radiacode.com/favicon.ico" alt="Radiacode" class="footer-icon">
                    <span>Powered by Radiacode</span>
                    <a href="https://www.radiacode.com" target="_blank" class="brand-link">radiacode.com</a>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>